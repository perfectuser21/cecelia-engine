---
id: dod-h7-concurrency-safety
version: 1.0.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
---

# DoD: 并发安全修复 (H7)

## 验收清单

- [ ] lib/lock-utils.sh 创建且 bash -n 通过 | Test: `bash -n lib/lock-utils.sh`
- [ ] lib/ci-status.sh 创建且 bash -n 通过 | Test: `bash -n lib/ci-status.sh`
- [ ] session_id 写入 .dev-mode | Test: grep session_id .dev-mode
- [ ] stop.sh 检查 session_id 匹配 | Test: concurrency.test.ts
- [ ] cleanup.sh 使用原子操作 | Test: concurrency.test.ts
- [ ] CI 状态查询带重试 | Test: concurrency.test.ts
- [ ] 现有测试全部通过 | Test: npm run test
- [ ] 新增测试通过 | Test: vitest run tests/hooks/concurrency.test.ts
