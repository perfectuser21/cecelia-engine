# PRD: 修复 Workflow 误触发问题

## 背景

当前两个 GitHub Actions workflows 存在 100% 失败率的"狼来了"问题：

1. **back-merge-main-to-develop.yml**: 配置为只在 `push: main` 时运行，但实际在所有分支的 push 都会触发
2. **nightly.yml**: 配置为只在 `schedule` 和 `workflow_dispatch` 时运行，但实际在 push 事件也会触发

**影响**：
- 所有 workflow runs 都失败（20+ runs for back-merge, 3+ for nightly）
- 无法区分真实失败和误触发失败
- 创建"狼来了"效应：真正的问题会被掩盖

## 需求

为两个 workflows 添加 guard job，检查触发事件和分支，只在正确条件下运行：

### back-merge-main-to-develop.yml
- ✅ 只在 `push` 事件 **且** `main` 分支时运行
- ❌ 其他任何情况跳过

### nightly.yml
- ✅ 只在 `schedule` 或 `workflow_dispatch` 事件时运行
- ❌ `push` 事件直接跳过

## 验收标准

1. 两个 workflows 都添加了 `check-trigger` guard job
2. Guard job 检查 `github.event_name` 和分支（如适用）
3. 其他 jobs 依赖 guard job 且使用 `if: needs.check-trigger.outputs.should-run == 'true'`
4. Push 到非 main 分支后，back-merge workflow 跳过执行（不失败）
5. Push 任何分支后，nightly workflow 跳过执行（不失败）

## 技术方案

Guard job 模式：

```yaml
jobs:
  check-trigger:
    runs-on: ubuntu-latest
    timeout-minutes: 1
    outputs:
      should-run: ${{ steps.check.outputs.should-run }}
    steps:
      - name: Check trigger
        id: check
        run: |
          # 检查逻辑
          # 设置 should-run=true/false

  actual-job:
    needs: [check-trigger]
    if: needs.check-trigger.outputs.should-run == 'true'
    # ...
```

## 优先级

P1 - 影响 CI 质量可靠性
