# L2B Evidence: 实施全新 CI 分层方案

## 手动验证

- [x] 本地运行 `npm run ci:preflight` 成功
- [x] 新增脚本可执行且权限正确
- [x] 模板文件创建成功

## 自动化测试

```bash
# 运行 preflight
npm run ci:preflight

# 输出示例
======================================
CI Preflight Check
======================================

==> L1 Fast: typecheck + test
✓ typecheck passed
✓ test passed (186/186)

==> L3 Fast Check
⚠️  lint 未配置，跳过
⚠️  format:check 未配置，跳过
✅ L3 Fast 检查通过（占位符）

==> L2A-min: 快速产物检查
✅ .prd.md 存在
✅ .dod.md 存在

======================================
✅ Preflight 检查通过
⏱️  耗时: 45s
======================================
```

```bash
# 测试 L2B 检查脚本
bash scripts/devgate/l2b-check.sh pr

# 输出示例
==> L2B Evidence Check (mode: pr)
✅ L2B-min 检查通过
```

## 文件清单

新增脚本：
- `scripts/devgate/l2b-check.sh` (755)
- `scripts/devgate/l3-fast.sh` (755)
- `scripts/devgate/ci-preflight.sh` (755)

修改文件：
- `hooks/pr-gate-v2.sh` (+30 行，增加 preflight + L2B-min)
- `.github/workflows/ci.yml` (+80 行，增加 l2b-check + ai-review jobs)
- `package.json` (+3 scripts)

新增模板：
- `templates/.layer2-evidence.template.md`

文档：
- `docs/QA-DECISION.md`
- `.prd.md`
- `.dod.md`
- `.layer2-evidence.md` (本文件)

## DoD 完成度

参见 `.dod.md`

所有必要项已完成：
- [x] M1: 新增 3 个脚本
- [x] M2: 修改 hook
- [x] M3: 修改 CI
- [x] M4: npm scripts
- [x] M5: 文档
